import{d as we,r as f,n as $,c as _e,o as u,w as b,a as e,i,u as d,l as Y,j as h,p as G,b as c,e as D,F as B,k as T,t as _,g as Z,z as Ce,f as j,q as Se,s as De,v as Pe,x as k,h as O,y as Ve}from"./app-cOy2W6zU.js";import{_ as Me}from"./AdminLayout-HrrkaHek.js";import{_ as U}from"./VueSelect.vue_vue_type_script_setup_true_lang-C-FB9EEV.js";import{u as Fe,c as Be,a as Te,b as ee,d as q,F as je,e as C,E as S}from"./index.esm-t0FLxFP7.js";import"./route-BVPoXIPw.js";import"./sidebar.esm-9qHROATk.js";const ze={class:"min-h-screen bg-gray-50"},Ee={class:"w-full mx-auto py-6 px-6"},Ke={class:"px-0"},$e={class:"mb-6 flex items-center justify-between"},Ge={class:"grid grid-cols-1 gap-6"},Oe={class:"space-y-6 bg-white shadow rounded-lg p-6"},Ue={class:"relative"},qe={class:"relative"},Ae={key:0,class:"mb-3 space-y-2"},He={class:"space-y-2"},Ie={class:"truncate flex items-center gap-2"},Ne=["title"],Je={class:"text-gray-500"},Le={class:"inline-flex items-center gap-2 text-red-600 cursor-pointer"},Re=["value"],Qe={key:1,class:"mt-3 space-y-2"},We={class:"truncate"},Xe={class:"font-medium"},Ye={class:"ml-2 text-gray-500"},Ze=["onClick"],et={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},tt={class:"space-y-2"},at={class:"flex gap-2"},ot=["onKeydown"],nt={key:0,class:"bg-white border border-gray-200 rounded-md shadow-sm divide-y z-10 max-h-56 overflow-auto"},st=["onClick"],rt={key:1,class:"flex flex-wrap gap-2"},lt=["onClick"],it={class:"sticky bottom-0 inset-x-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-t border-gray-200 px-6 py-4 flex justify-end gap-3 shadow-lg"},dt=["disabled"],ut={key:0},ct={key:1},mt=null,yt=we({__name:"Edit",props:{knowledge:{},categories:{},skpds:{}},setup(te){var H,I,N,J,L,R,Q,W;const p=te,w={title:((H=p.knowledge)==null?void 0:H.title)||"",description:((I=p.knowledge)==null?void 0:I.description)||"",content:((N=p.knowledge)==null?void 0:N.content)||"",category_id:((J=p.knowledge)==null?void 0:J.category_id)||"",skpd_id:((L=p.knowledge)==null?void 0:L.skpd_id)||"",status:((R=p.knowledge)==null?void 0:R.status)||"draft"},ae=f(null),{setFieldValue:pt}=Fe(),P=f(null),x=f([]),A=f(((Q=p.knowledge)==null?void 0:Q.attachments)||[]),z=f([]),V=f(!1),oe=a=>{const t=a.target,s=Array.from(t.files||[]);if(s.length){const r=s.filter(l=>/^(application\/(pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|spreadsheetml\.sheet|presentationml\.presentation)|msword|vnd\.ms-excel|vnd\.ms-powerpoint)|image\/(jpeg|jpg|png))$/.test(l.type));r.length!==s.length&&k.error("Hanya dokumen (PDF/Office) atau gambar (JPG/PNG) yang diizinkan");const o=[...x.value,...r];o.reduce((l,m)=>l+((m==null?void 0:m.size)||0),0)>5*1024*1024?k.error("Total ukuran lampiran maksimal 5MB"):x.value=o}P.value&&(P.value.value="")},ne=()=>{V.value=!0},se=()=>{V.value=!1},re=a=>{var n;V.value=!1;const t=Array.from(((n=a.dataTransfer)==null?void 0:n.files)||[]);if(!t.length)return;const s=t.filter(l=>/^(application\/(pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|spreadsheetml\.sheet|presentationml\.presentation)|msword|vnd\.ms-excel|vnd\.ms-powerpoint)|image\/(jpeg|jpg|png))$/.test(l.type));s.length!==t.length&&k.error("Hanya dokumen (PDF/Office) atau gambar (JPG/PNG) yang diizinkan");const r=[...x.value,...s];r.reduce((l,m)=>l+((m==null?void 0:m.size)||0),0)>5*1024*1024?k.error("Total ukuran lampiran maksimal 5MB"):x.value=r},le=a=>{x.value.splice(a,1)},ie=a=>!a||a<=0?"0 B":`${(a/1024/1024).toFixed(2)} MB`,v=f(""),g=f(Array.isArray((W=p.knowledge)==null?void 0:W.tags)?p.knowledge.tags:[]),y=f([]);let E=null;const de=async()=>{var a;if(!(v.value.trim().length>0))try{const t=await O.get("/api/knowledge/tags");y.value=((a=t.data)==null?void 0:a.data)||[]}catch{y.value=[]}},ue=()=>{const a=v.value.trim();E&&clearTimeout(E),E=setTimeout(async()=>{var t;if(a.length===0){y.value=[];return}try{const s=await O.get("/api/knowledge/tags",{params:{q:a}});y.value=((t=s.data)==null?void 0:t.data)||[]}catch{y.value=[]}},250)},ce=()=>{const a=v.value.trim();a&&(a.split(",").map(t=>t.trim()).filter(Boolean).forEach(t=>{g.value.includes(t)||g.value.push(t)}),v.value="")},me=a=>g.value.splice(a,1),pe=a=>{a&&(g.value.includes(a)||g.value.push(a),v.value="",y.value=[])},M=f([...p.categories]),ge=$(()=>M.value.map(a=>({value:a.id,label:a.name}))),fe=$(()=>p.skpds.map(a=>({value:a.id,label:a.nama_skpd}))),be=$(()=>[{value:"draft",label:"Draft"},{value:"published",label:"Dipublikasi"},{value:"archived",label:"Diarsipkan"}]),ve=async(a,t)=>{var s,r,o,n;try{const l=await O.post("/api/knowledge/categories/quick-create",{name:a});if((s=l.data)!=null&&s.success&&((r=l.data)!=null&&r.data)){const m=l.data.data;M.value.some(K=>K.id===m.id)||(M.value=[...M.value,m]),t(m.id),k.success("Kategori ditambahkan")}else k.error("Gagal menambah kategori")}catch(l){k.error(((n=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:n.message)||"Gagal menambah kategori")}},he=Be({title:q().required("Judul wajib diisi").max(255),description:q().nullable().max(500),content:q().required("Konten wajib diisi").min(10,"Minimal 10 karakter"),category_id:ee().typeError("Pilih kategori").required("Kategori wajib diisi"),skpd_id:ee().typeError("Pilih SKPD").required("SKPD wajib diisi"),status:Te().oneOf(["draft","published","archived"]).required("Status wajib diisi")}),F=f(!1),xe=(a,t)=>{const s=!(a!=null&&a.title)||String(a.title).trim()==="",r=!(a!=null&&a.content)||String(a.content).trim()==="",o=!(a!=null&&a.category_id),n=!(a!=null&&a.skpd_id),l=!(a!=null&&a.status),m=!(a!=null&&a.description)||String(a.description).trim()==="",X=g.value.length===0,K=s&&r&&o&&n&&l&&m&&X;return F.value||!t||K},ye=a=>{const t=a==null?void 0:a.target;t&&(t.style.height="auto",t.style.height=t.scrollHeight+"px")},ke=async a=>{F.value=!0;const t=(v.value||"").trim();t&&(t.split(",").map(r=>r.trim()).filter(Boolean).forEach(r=>{g.value.includes(r)||g.value.push(r)}),v.value="");const s=new FormData;s.append("title",a.title||""),s.append("description",a.description||""),s.append("content",a.content||""),s.append("category_id",String(a.category_id||"")),s.append("skpd_id",String(a.skpd_id||"")),s.append("status",a.status||"draft"),g.value.forEach(r=>s.append("tags[]",r)),x.value.forEach(r=>s.append("attachments[]",r)),z.value.forEach(r=>s.append("remove_attachment_ids[]",String(r))),s.append("_method","PUT"),Ve.post(`/knowledge/${p.knowledge.id}`,s,{forceFormData:!0,onSuccess:()=>{k.success("Berhasil mengubah pengetahuan"),window.scrollTo({top:0,behavior:"auto"})},onFinish:()=>{F.value=!1}})};return(a,t)=>(u(),_e(Me,{"page-title":"Edit Pengetahuan",user:mt},{default:b(()=>[e("div",ze,[e("div",Ee,[e("div",Ke,[e("div",$e,[i(d(Y),{href:a.route("knowledge.show",a.knowledge.id),class:"text-brand-700 hover:text-brand-800 mr-4"},{default:b(()=>t[3]||(t[3]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),_:1,__:[3]},8,["href"]),t[4]||(t[4]=e("div",{class:"flex-1"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Edit Pengetahuan"),e("p",{class:"text-gray-600 mt-2"},"Perbarui data pengetahuan")],-1)),t[5]||(t[5]=e("div",{class:"hidden md:flex items-center gap-3"},[e("span",{class:"inline-flex items-center rounded-full bg-brand-50 px-3 py-1 text-sm font-medium text-brand-700 border border-brand-100"},"Form")],-1))]),i(d(je),{ref_key:"formRef",ref:ae,"validation-schema":d(he),onSubmit:ke,class:"space-y-6"},{default:b(({meta:s,values:r})=>[e("div",Ge,[e("div",Oe,[e("div",null,[t[7]||(t[7]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[h("Judul "),e("span",{class:"text-red-500"},"*")],-1)),i(d(C),{name:"title","model-value":w.title},{default:b(({field:o,meta:n})=>[e("div",Ue,[t[6]||(t[6]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 012-2h3l2 2h3a2 2 0 012 2v2H4V4zM4 9h12v5a2 2 0 01-2 2H6a2 2 0 01-2-2V9z"})])],-1)),e("input",G(o,{id:"title",type:"text",class:["w-full pl-10 pr-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.touched&&n.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan judul pengetahuan"}),null,16)])]),_:2},1032,["model-value"]),i(d(S),{name:"title",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[8]||(t[8]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},"Deskripsi Singkat",-1)),i(d(C),{name:"description","model-value":w.description},{default:b(({field:o,meta:n})=>[e("div",qe,[e("textarea",G(o,{id:"description",rows:"3",class:["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.touched&&n.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan deskripsi singkat pengetahuan"}),null,16)])]),_:2},1032,["model-value"]),i(d(S),{name:"description",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[9]||(t[9]=e("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-2"},[h("Konten "),e("span",{class:"text-red-500"},"*")],-1)),i(d(C),{name:"content","model-value":w.content},{default:b(({field:o,meta:n})=>[e("textarea",G(o,{id:"content",rows:"14",class:["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors resize-none",n.touched&&n.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan konten lengkap pengetahuan",onInput:ye}),null,16)]),_:2},1032,["model-value"]),i(d(S),{name:"content",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Lampiran",-1)),A.value.length?(u(),c("div",Ae,[t[12]||(t[12]=e("div",{class:"text-xs text-gray-500"},"Lampiran saat ini:",-1)),e("ul",He,[(u(!0),c(B,null,T(A.value,o=>(u(),c("li",{key:o.id,class:"flex items-center justify-between bg-gray-50 border rounded px-3 py-2 text-sm"},[e("div",Ie,[t[10]||(t[10]=e("svg",{class:"w-4 h-4 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"})],-1)),e("span",{class:"font-medium truncate max-w-[320px]",title:o.original_name},_(o.original_name),9,Ne),e("span",Je,"("+_(ie(o.size_bytes))+")",1)]),e("label",Le,[Z(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=n=>z.value=n),value:o.id,class:"rounded border-gray-300 text-red-600 focus:ring-red-500"},null,8,Re),[[Ce,z.value]]),t[11]||(t[11]=h(" Hapus ",-1))])]))),128))])])):D("",!0),e("div",{class:Se(["border-2 border-dashed rounded-lg p-4 text-center cursor-pointer bg-white hover:bg-gray-50",V.value?"border-brand-400 bg-brand-50/30":"border-gray-300"]),onDragover:j(ne,["prevent"]),onDragleave:j(se,["prevent"]),onDrop:j(re,["prevent"]),onClick:t[1]||(t[1]=()=>{var o;return(o=P.value)==null?void 0:o.click()})},[e("input",{ref_key:"fileInput",ref:P,type:"file",multiple:"",class:"hidden",onChange:oe},null,544),t[13]||(t[13]=e("div",{class:"flex flex-col items-center gap-1 text-sm text-gray-600"},[e("svg",{class:"w-8 h-8 text-brand-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12l-2 2m0 0l-2-2m2 2V4"})]),e("span",null,[e("span",{class:"font-medium text-brand-700"},"Klik"),h(" atau seret file ke sini")]),e("span",{class:"text-xs text-gray-400"},"Dokumen (PDF, Office) atau Gambar (JPG/PNG). Total maks 5MB.")],-1))],34),x.value.length?(u(),c("ul",Qe,[(u(!0),c(B,null,T(x.value,(o,n)=>(u(),c("li",{key:n,class:"flex items-center justify-between bg-white border rounded px-3 py-2 text-sm"},[e("div",We,[e("span",Xe,_(o.name),1),e("span",Ye,"("+_((o.size/1024/1024).toFixed(2))+" MB)",1)]),e("button",{type:"button",onClick:l=>le(n),class:"text-red-600 hover:text-red-700"},"Hapus",8,Ze)]))),128))])):D("",!0)]),e("div",et,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[h("Kategori "),e("span",{class:"text-red-500"},"*")],-1)),i(d(C),{name:"category_id","model-value":w.category_id},{default:b(({field:o})=>[i(U,{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,options:ge.value,placeholder:"Pilih Kategori atau ketik untuk menambah",onChange:n=>o.onChange(n),onAdd:n=>ve(n,l=>o.onChange(l))},null,8,["modelValue","onUpdate:modelValue","options","onChange","onAdd"])]),_:1},8,["model-value"]),i(d(S),{name:"category_id",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[h("SKPD "),e("span",{class:"text-red-500"},"*")],-1)),i(d(C),{name:"skpd_id","model-value":w.skpd_id},{default:b(({field:o})=>[i(U,{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,options:fe.value,placeholder:"Pilih SKPD",onChange:n=>o.onChange(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["model-value"]),i(d(S),{name:"skpd_id",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[h("Status "),e("span",{class:"text-red-500"},"*")],-1)),i(d(C),{name:"status","model-value":w.status},{default:b(({field:o})=>[i(U,{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,options:be.value,placeholder:"Pilih Status",onChange:n=>o.onChange(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["model-value"]),i(d(S),{name:"status",class:"mt-1 text-sm text-red-600"})])]),e("div",null,[t[19]||(t[19]=e("label",{for:"tags",class:"block text-sm font-medium text-gray-700 mb-2"},"Tags",-1)),e("div",tt,[e("div",at,[Z(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>v.value=o),id:"tags",type:"text",class:"w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors hover:border-gray-400",placeholder:"Ketik tag lalu Enter, atau klik saran di bawah",onFocus:de,onInput:ue,onKeydown:De(j(ce,["prevent"]),["enter"])},null,40,ot),[[Pe,v.value]])]),y.value.length>0?(u(),c("div",nt,[(u(!0),c(B,null,T(y.value,o=>(u(),c("button",{key:o.id||o.name,type:"button",class:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:n=>pe(o.name)},_(o.name),9,st))),128))])):D("",!0),g.value.length>0?(u(),c("div",rt,[g.value.length>0?(u(!0),c(B,{key:0},T(g.value,(o,n)=>(u(),c("span",{key:n,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-brand-100 text-brand-800"},[h(_(o)+" ",1),e("button",{type:"button",onClick:l=>me(n),class:"ml-2 text-brand-700 hover:text-brand-900"},t[18]||(t[18]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,lt)]))),128)):D("",!0)])):D("",!0)])])])]),e("div",it,[i(d(Y),{href:a.route("knowledge.show",a.knowledge.id),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500"},{default:b(()=>t[20]||(t[20]=[h("Batal",-1)])),_:1,__:[20]},8,["href"]),e("button",{type:"submit",disabled:xe(r,s.valid),class:"px-5 py-2.5 border border-transparent rounded-md shadow-sm text-sm font-semibold text-white bg-brand-700 hover:bg-brand-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed"},[F.value?(u(),c("span",ut,"Menyimpan...")):(u(),c("span",ct,"Simpan Perubahan"))],8,dt)])]),_:1},8,["validation-schema"])])])])]),_:1}))}});export{yt as default};
