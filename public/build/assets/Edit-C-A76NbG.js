import{r as v,p as P,A as q,c as Q,o as a,w as C,a as t,b as l,e as u,t as i,i as k,u as w,j as T,f as V,k as f,s as m,g,v as b,F as U,m as S,y as R,l as E}from"./app-DF53rvan.js";import{_ as W}from"./AdminLayout-DGHjjutr.js";import{_ as A}from"./VueSelect.vue_vue_type_script_setup_true_lang-CUgeL11w.js";import{r as D}from"./route-BVPoXIPw.js";import"./sidebar.esm-DrwL718E.js";const X={class:"min-h-screen bg-gray-50"},Y={class:"w-full mx-auto py-6 px-6"},Z={class:"px-0"},ee={key:0,class:"mb-4"},te={class:"rounded-md bg-green-50 p-4 border border-green-200"},se={class:"text-sm font-medium text-green-800"},ne={class:"mb-6 flex items-center justify-between"},oe={class:"flex-1"},re={class:"text-gray-600 mt-2"},ae={class:"grid grid-cols-1 gap-6"},le={class:"space-y-6"},ie={class:"bg-white shadow rounded-lg p-6"},de={class:"space-y-6"},ue={key:0,class:"mt-1 text-sm text-red-600"},ce={key:0,class:"mt-1 text-sm text-red-600"},me={key:0,class:"mt-1 text-sm text-red-600"},pe={key:0,class:"mt-1 text-sm text-red-600"},ve={key:0,class:"mt-1 text-sm text-red-600"},fe={key:0},ge={class:"space-y-2"},be={class:"truncate"},xe={class:"font-medium"},ye={class:"ml-2 text-gray-500"},_e=["onClick"],he={key:0,class:"mt-3 space-y-2"},ke={class:"truncate"},we={class:"font-medium"},Ve={class:"ml-2 text-gray-500"},Ee=["onClick"],Me={key:0,class:"mt-1 text-sm text-red-600"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De={key:0,class:"mt-1 text-sm text-red-600"},je={key:0,class:"mt-1 text-sm text-red-600"},Be={key:0,class:"mt-1 text-sm text-red-600"},Fe={class:"flex justify-end space-x-3 pt-6"},Pe=["disabled"],Te={key:0,class:"inline-block w-4 h-4 border-2 border-white/70 border-t-transparent rounded-full animate-spin mr-2"},Oe={__name:"Edit",props:{version:{type:Object,required:!0},knowledgeList:{type:Array,default:()=>[]},tagList:{type:Array,default:()=>[]},user:{type:Object,default:()=>({})}},setup(x){const d=x,r=v({knowledge_id:"",version_number:"",title:"",description:"",content:"",tags:[],effective_date:"",expiry_date:"",change_notes:""}),n=v({}),y=v(!1),_=v([]),h=v(!1),j=v(null),B=v([]),$=P(()=>d.knowledgeList.map(s=>({value:s.id,label:s.title}))),z=P(()=>d.tagList.map(s=>({value:s.id,label:s.name})));q(()=>{var s;r.value={knowledge_id:d.version.knowledge_id,version_number:d.version.version_number,title:d.version.title,description:d.version.description||"",content:d.version.content,tags:((s=d.version.tags)==null?void 0:s.map(e=>e.id))||[],effective_date:d.version.effective_date||"",expiry_date:d.version.expiry_date||"",change_notes:d.version.change_notes||""}});function L(s){return(s/1024/1024).toFixed(2)+" MB"}function O(s){B.value.push(s);const e=d.version.attachments.findIndex(c=>c.id===s);e>-1&&d.version.attachments.splice(e,1)}function N(){h.value=!0}function G(){h.value=!1}function I(s){h.value=!1;const e=Array.from(s.dataTransfer.files);F(e)}function J(s){const e=Array.from(s.target.files);F(e)}function F(s){const c=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/png"];s.forEach(p=>{if(!c.includes(p.type)){E.error(`File ${p.name} tidak didukung`);return}if(p.size>5242880){E.error(`File ${p.name} terlalu besar (maks 5MB)`);return}_.value.push(p)})}function K(s){_.value.splice(s,1)}function H(){y.value=!0,n.value={};const s=new FormData;Object.keys(r.value).forEach(e=>{e==="tags"?r.value[e].forEach(c=>{s.append("tags[]",c)}):s.append(e,r.value[e]||"")}),_.value.forEach((e,c)=>{s.append(`attachments[${c}]`,e)}),B.value.forEach(e=>{s.append("removed_attachments[]",e)}),s.append("_method","PUT"),R.post(D("admin.knowledge-versions.update",d.version.id),s,{onSuccess:()=>{E.success("Versi pengetahuan berhasil diupdate!")},onError:e=>{n.value=e,E.error("Gagal mengupdate versi pengetahuan!")},onFinish:()=>{y.value=!1}})}return(s,e)=>(a(),Q(W,{"page-title":"Edit Versi Pengetahuan",user:x.user},{default:C(()=>{var c,p;return[t("div",X,[t("div",Y,[t("div",Z,[(c=s.$page.props.flash)!=null&&c.success?(a(),l("div",ee,[t("div",te,[t("p",se,i(s.$page.props.flash.success),1)])])):u("",!0),t("div",ne,[k(w(T),{href:w(D)("admin.knowledge-versions.index"),class:"text-brand-700 hover:text-brand-800 mr-4"},{default:C(()=>e[10]||(e[10]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),_:1,__:[10]},8,["href"]),t("div",oe,[e[11]||(e[11]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Edit Versi Pengetahuan",-1)),t("p",re,"Edit versi "+i(x.version.version_number)+" - "+i(x.version.title),1)]),e[12]||(e[12]=t("div",{class:"hidden md:flex items-center gap-3"},[t("span",{class:"inline-flex items-center rounded-full bg-brand-50 px-3 py-1 text-sm font-medium text-brand-700 border border-brand-100"},"Edit")],-1))]),t("form",{onSubmit:V(H,["prevent"]),class:"space-y-6"},[t("div",ae,[t("div",le,[t("div",ie,[t("div",de,[t("div",null,[e[13]||(e[13]=t("label",{for:"knowledge_id",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Pengetahuan "),t("span",{class:"text-red-500"},"*")],-1)),k(A,{modelValue:r.value.knowledge_id,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.knowledge_id=o),options:$.value,placeholder:"Pilih Pengetahuan...",class:m(n.value.knowledge_id?"border-red-500":"border-gray-300")},null,8,["modelValue","options","class"]),n.value.knowledge_id?(a(),l("div",ue,i(n.value.knowledge_id),1)):u("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{for:"version_number",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Nomor Versi "),t("span",{class:"text-red-500"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.version_number=o),id:"version_number",type:"text",class:m(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.value.version_number?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Contoh: 1.0, 1.1, 2.0"},null,2),[[b,r.value.version_number]]),n.value.version_number?(a(),l("div",ce,i(n.value.version_number),1)):u("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Judul "),t("span",{class:"text-red-500"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.title=o),id:"title",type:"text",class:m(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.value.title?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Masukkan judul versi pengetahuan"},null,2),[[b,r.value.title]]),n.value.title?(a(),l("div",me,i(n.value.title),1)):u("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},"Deskripsi Singkat",-1)),g(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.description=o),id:"description",rows:"3",class:m(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.value.description?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Masukkan deskripsi singkat versi pengetahuan"},null,2),[[b,r.value.description]]),n.value.description?(a(),l("div",pe,i(n.value.description),1)):u("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Konten "),t("span",{class:"text-red-500"},"*")],-1)),g(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.content=o),id:"content",rows:"14",class:m(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors resize-none",n.value.content?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Masukkan konten lengkap versi pengetahuan"},null,2),[[b,r.value.content]]),n.value.content?(a(),l("div",ve,i(n.value.content),1)):u("",!0)]),(p=x.version.attachments)!=null&&p.length?(a(),l("div",fe,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Lampiran Saat Ini",-1)),t("ul",ge,[(a(!0),l(U,null,S(x.version.attachments,o=>(a(),l("li",{key:o.id,class:"flex items-center justify-between bg-gray-50 border rounded px-3 py-2 text-sm"},[t("div",be,[t("span",xe,i(o.original_name),1),t("span",ye,"("+i(L(o.file_size))+")",1)]),t("button",{type:"button",onClick:M=>O(o.id),class:"text-red-600 hover:text-red-700"},"Hapus",8,_e)]))),128))])])):u("",!0),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tambah Lampiran Baru",-1)),t("div",{class:m(["border-2 border-dashed rounded-lg p-4 text-center cursor-pointer bg-white hover:bg-gray-50",h.value?"border-brand-400 bg-brand-50/30":"border-gray-300"]),onDragover:V(N,["prevent"]),onDragleave:V(G,["prevent"]),onDrop:V(I,["prevent"]),onClick:e[5]||(e[5]=()=>{var o;return(o=j.value)==null?void 0:o.click()})},[t("input",{ref_key:"fileInput",ref:j,type:"file",multiple:"",class:"hidden",onChange:J},null,544),e[19]||(e[19]=t("div",{class:"flex flex-col items-center gap-1 text-sm text-gray-600"},[t("svg",{class:"w-8 h-8 text-brand-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12l-2 2m0 0l-2-2m2 2V4"})]),t("span",null,[t("span",{class:"font-medium text-brand-700"},"Klik"),f(" atau seret file ke sini")]),t("span",{class:"text-xs text-gray-400"},"Dokumen (PDF, Office) atau Gambar (JPG/PNG). Total maks 5MB.")],-1))],34),_.value.length?(a(),l("ul",he,[(a(!0),l(U,null,S(_.value,(o,M)=>(a(),l("li",{key:M,class:"flex items-center justify-between bg-white border rounded px-3 py-2 text-sm"},[t("div",ke,[t("span",we,i(o.name),1),t("span",Ve,"("+i((o.size/1024/1024).toFixed(2))+" MB)",1)]),t("button",{type:"button",onClick:Ue=>K(M),class:"text-red-600 hover:text-red-700"},"Hapus",8,Ee)]))),128))])):u("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{for:"tags",class:"block text-sm font-medium text-gray-700 mb-2"},"Tags",-1)),k(A,{modelValue:r.value.tags,"onUpdate:modelValue":e[6]||(e[6]=o=>r.value.tags=o),options:z.value,placeholder:"Pilih Tags...",multiple:"",class:m(n.value.tags?"border-red-500":"border-gray-300")},null,8,["modelValue","options","class"]),n.value.tags?(a(),l("div",Me,i(n.value.tags),1)):u("",!0)]),t("div",Ce,[t("div",null,[e[22]||(e[22]=t("label",{for:"effective_date",class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Efektif",-1)),g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.value.effective_date=o),id:"effective_date",type:"date",class:m(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.value.effective_date?"border-red-500":"border-gray-300 hover:border-gray-400"])},null,2),[[b,r.value.effective_date]]),n.value.effective_date?(a(),l("div",De,i(n.value.effective_date),1)):u("",!0)]),t("div",null,[e[23]||(e[23]=t("label",{for:"expiry_date",class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Kadaluarsa",-1)),g(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>r.value.expiry_date=o),id:"expiry_date",type:"date",class:m(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.value.expiry_date?"border-red-500":"border-gray-300 hover:border-gray-400"])},null,2),[[b,r.value.expiry_date]]),n.value.expiry_date?(a(),l("div",je,i(n.value.expiry_date),1)):u("",!0)])]),t("div",null,[e[24]||(e[24]=t("label",{for:"change_notes",class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Perubahan",-1)),g(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=o=>r.value.change_notes=o),id:"change_notes",rows:"3",class:m(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.value.change_notes?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Jelaskan perubahan yang dilakukan pada versi ini"},null,2),[[b,r.value.change_notes]]),n.value.change_notes?(a(),l("div",Be,i(n.value.change_notes),1)):u("",!0)])])])])]),t("div",Fe,[k(w(T),{href:w(D)("admin.knowledge-versions.index"),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500"},{default:C(()=>e[25]||(e[25]=[f(" Batal ",-1)])),_:1,__:[25]},8,["href"]),t("button",{type:"submit",disabled:y.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50"},[y.value?(a(),l("span",Te)):u("",!0),f(" "+i(y.value?"Menyimpan...":"Update Versi"),1)],8,Pe)])],32)])])])]}),_:1},8,["user"]))}};export{Oe as default};
