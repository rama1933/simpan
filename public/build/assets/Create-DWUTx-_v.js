import{r as m,p as I,c as se,o as r,w as j,b as t,e as l,f as d,t as i,j as S,u as M,l as K,g as C,k as f,s as p,h as g,v as b,F as z,m as A,x as ae,z as N,y as _,i as $}from"./app-DLA9WpCp.js";import{_ as ne}from"./AdminLayout-CEoUBitx.js";import{_ as oe}from"./VueSelect.vue_vue_type_script_setup_true_lang-DkrUs91k.js";import{r as B}from"./route-BVPoXIPw.js";import"./sidebar.esm-CYszHoo9.js";const re={class:"min-h-screen bg-gray-50"},le={class:"w-full mx-auto py-6 px-6"},ie={class:"px-0"},de={key:0,class:"mb-4"},ue={class:"rounded-md bg-green-50 p-4 border border-green-200"},ce={class:"text-sm font-medium text-green-800"},me={class:"mb-6 flex items-center justify-between"},pe={class:"grid grid-cols-1 gap-6"},ve={class:"space-y-6"},fe={class:"bg-white shadow rounded-lg p-6"},ge={class:"space-y-6"},be={key:0,class:"mt-1 text-sm text-red-600"},xe={key:0,class:"mt-1 text-sm text-red-600"},ye={class:"relative"},he=["disabled"],ke={key:0,class:"inline-block w-4 h-4 border-2 border-white/70 border-t-transparent rounded-full animate-spin"},_e={key:0,class:"mt-1 text-sm text-red-600"},we={key:0,class:"mt-1 text-sm text-red-600"},Ve={key:0,class:"mt-1 text-sm text-red-600"},Ce={key:0,class:"mt-3 space-y-2"},Te={class:"truncate"},Me={class:"font-medium"},Be={class:"ml-2 text-gray-500"},Fe=["onClick"],De={class:"space-y-2"},je={class:"flex gap-2"},Se=["onKeydown"],ze={key:0,class:"bg-white border border-gray-200 rounded-md shadow-sm divide-y z-10 max-h-56 overflow-auto"},Ae=["onClick"],$e={key:1,class:"flex flex-wrap gap-2"},Ee=["onClick"],Le={key:0,class:"mt-1 text-sm text-red-600"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ue={key:0,class:"mt-1 text-sm text-red-600"},Ie={key:0,class:"mt-1 text-sm text-red-600"},Ke={key:0,class:"mt-1 text-sm text-red-600"},Ne={class:"flex justify-end space-x-3 pt-6"},Oe=["disabled"],Ge={key:0,class:"inline-block w-4 h-4 border-2 border-white/70 border-t-transparent rounded-full animate-spin mr-2"},We={__name:"Create",props:{knowledgeList:{type:Array,default:()=>[]},tagList:{type:Array,default:()=>[]},user:{type:Object,default:()=>({})}},setup(E){const L=E,n=m({knowledge_id:"",version_number:"",title:"",description:"",content:"",tags:[],effective_date:"",expiry_date:"",change_notes:""}),o=m({}),w=m(!1),y=m([]),T=m(!1),P=m(null),V=m(!1),O=I(()=>L.knowledgeList.map(a=>({value:a.id,label:a.title})));I(()=>L.tagList.map(a=>({value:a.id,label:a.name})));const x=m(""),v=m([]);let F=null;const G=async()=>{var a;if(!(x.value.trim().length>0))try{const e=await $.get("/api/knowledge/tags");v.value=((a=e.data)==null?void 0:a.data)||[]}catch{v.value=[]}},H=()=>{const a=x.value.trim();a&&(a.split(",").map(e=>e.trim()).filter(Boolean).forEach(e=>{n.value.tags.includes(e)||n.value.tags.push(e)}),x.value="")},J=a=>{n.value.tags.splice(a,1)},q=async()=>{const a=x.value.trim();F&&clearTimeout(F),F=setTimeout(async()=>{var e;if(a.length===0){v.value=[];return}try{const u=await $.get("/api/knowledge/tags",{params:{q:a}});v.value=((e=u.data)==null?void 0:e.data)||[]}catch{v.value=[]}},250)},R=a=>{a&&(n.value.tags.includes(a)||n.value.tags.push(a),x.value="",v.value=[])};function Q(){T.value=!0}function W(){T.value=!1}function X(a){T.value=!1;const e=Array.from(a.dataTransfer.files);U(e)}function Y(a){const e=Array.from(a.target.files);U(e)}function U(a){const u=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/png"];a.forEach(s=>{if(!u.includes(s.type)){_.error(`File ${s.name} tidak didukung`);return}if(s.size>5242880){_.error(`File ${s.name} terlalu besar (maks 5MB)`);return}y.value.push(s)})}function Z(a){y.value.splice(a,1)}const ee=async a=>{var u,s,c;const e=(a||"").trim();if(!(e.length<5))try{V.value=!0;const k=((u=(await $.post("/api/ai/draft-from-title",{title:e})).data)==null?void 0:u.data)||{};if(k.description&&(n.value.description=k.description),k.content&&(n.value.content=k.content),Array.isArray(k.tags))for(const D of k.tags)D&&!n.value.tags.includes(D)&&n.value.tags.push(String(D));_.success("Draft diisi otomatis oleh AI")}catch(h){_.error(((c=(s=h==null?void 0:h.response)==null?void 0:s.data)==null?void 0:c.message)||"Gagal membuat draft dari judul")}finally{V.value=!1}};function te(){w.value=!0,o.value={},console.log("Form data before submit:",n.value),console.log("Attachments:",y.value);const a=new FormData;Object.keys(n.value).forEach(e=>{e==="tags"?n.value[e].forEach(u=>{a.append("tags[]",u)}):a.append(e,n.value[e]||"")}),y.value.forEach((e,u)=>{a.append(`attachments[${u}]`,e)}),N.post(B("admin.knowledge-versions.store"),a,{onSuccess:()=>{_.success("Versi pengetahuan berhasil dibuat!"),N.visit(B("admin.knowledge-versions.index"))},onError:e=>{o.value=e,_.error("Gagal membuat versi pengetahuan!")},onFinish:()=>{w.value=!1}})}return(a,e)=>(r(),se(ne,{"page-title":"Tambah Versi Pengetahuan",user:E.user},{default:j(()=>{var u;return[t("div",re,[t("div",le,[t("div",ie,[(u=a.$page.props.flash)!=null&&u.success?(r(),l("div",de,[t("div",ue,[t("p",ce,i(a.$page.props.flash.success),1)])])):d("",!0),t("div",me,[S(M(K),{href:M(B)("admin.knowledge-versions.index"),class:"text-brand-700 hover:text-brand-800 mr-4"},{default:j(()=>e[11]||(e[11]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),_:1,__:[11]},8,["href"]),e[12]||(e[12]=t("div",{class:"flex-1"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"Tambah Versi Pengetahuan Baru"),t("p",{class:"text-gray-600 mt-2"},"Buat versi baru untuk pengetahuan yang sudah ada")],-1)),e[13]||(e[13]=t("div",{class:"hidden md:flex items-center gap-3"},[t("span",{class:"inline-flex items-center rounded-full bg-brand-50 px-3 py-1 text-sm font-medium text-brand-700 border border-brand-100"},"Form")],-1))]),t("form",{onSubmit:C(te,["prevent"]),class:"space-y-6"},[t("div",pe,[t("div",ve,[t("div",fe,[t("div",ge,[t("div",null,[e[14]||(e[14]=t("label",{for:"knowledge_id",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Pengetahuan "),t("span",{class:"text-red-500"},"*")],-1)),S(oe,{modelValue:n.value.knowledge_id,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.knowledge_id=s),options:O.value,placeholder:"Pilih Pengetahuan...",class:p(o.value.knowledge_id?"border-red-500":"border-gray-300")},null,8,["modelValue","options","class"]),o.value.knowledge_id?(r(),l("div",be,i(o.value.knowledge_id),1)):d("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{for:"version_number",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Nomor Versi "),t("span",{class:"text-red-500"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.version_number=s),id:"version_number",type:"text",class:p(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",o.value.version_number?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Contoh: 1.0, 1.1, 2.0"},null,2),[[b,n.value.version_number]]),o.value.version_number?(r(),l("div",xe,i(o.value.version_number),1)):d("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Judul "),t("span",{class:"text-red-500"},"*")],-1)),t("div",ye,[e[16]||(e[16]=t("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[t("svg",{class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M4 4a2 2 0 012-2h3l2 2h3a2 2 0 012 2v2H4V4zM4 9h12v5a2 2 0 01-2 2H6a2 2 0 01-2-2V9z"})])],-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.title=s),id:"title",type:"text",class:p(["w-full pl-10 pr-24 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",o.value.title?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Masukkan judul versi pengetahuan"},null,2),[[b,n.value.title]]),t("button",{type:"button",onClick:e[3]||(e[3]=()=>ee(n.value.title)),disabled:V.value,class:"absolute inset-y-0 right-2 my-1 px-3 inline-flex items-center gap-2 rounded-md text-sm font-medium text-white bg-gradient-to-r from-brand-700 to-brand-500 shadow hover:from-brand-600 hover:to-brand-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50"},[V.value?(r(),l("span",ke)):d("",!0),t("span",null,i(V.value?"Memprosesâ€¦":"Bantu AI"),1)],8,he)]),o.value.title?(r(),l("div",_e,i(o.value.title),1)):d("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},"Deskripsi Singkat",-1)),g(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.description=s),id:"description",rows:"3",class:p(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",o.value.description?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Masukkan deskripsi singkat versi pengetahuan"},null,2),[[b,n.value.description]]),o.value.description?(r(),l("div",we,i(o.value.description),1)):d("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-2"},[f("Konten "),t("span",{class:"text-red-500"},"*")],-1)),g(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.content=s),id:"content",rows:"14",class:p(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors resize-none",o.value.content?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Masukkan konten lengkap versi pengetahuan"},null,2),[[b,n.value.content]]),o.value.content?(r(),l("div",Ve,i(o.value.content),1)):d("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Lampiran",-1)),t("div",{class:p(["border-2 border-dashed rounded-lg p-4 text-center cursor-pointer bg-white hover:bg-gray-50",T.value?"border-brand-400 bg-brand-50/30":"border-gray-300"]),onDragover:C(Q,["prevent"]),onDragleave:C(W,["prevent"]),onDrop:C(X,["prevent"]),onClick:e[6]||(e[6]=()=>{var s;return(s=P.value)==null?void 0:s.click()})},[t("input",{ref_key:"fileInput",ref:P,type:"file",multiple:"",class:"hidden",onChange:Y},null,544),e[20]||(e[20]=t("div",{class:"flex flex-col items-center gap-1 text-sm text-gray-600"},[t("svg",{class:"w-8 h-8 text-brand-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12l-2 2m0 0l-2-2m2 2V4"})]),t("span",null,[t("span",{class:"font-medium text-brand-700"},"Klik"),f(" atau seret file ke sini")]),t("span",{class:"text-xs text-gray-400"},"Dokumen (PDF, Office) atau Gambar (JPG/PNG). Total maks 5MB.")],-1))],34),y.value.length?(r(),l("ul",Ce,[(r(!0),l(z,null,A(y.value,(s,c)=>(r(),l("li",{key:c,class:"flex items-center justify-between bg-white border rounded px-3 py-2 text-sm"},[t("div",Te,[t("span",Me,i(s.name),1),t("span",Be,"("+i((s.size/1024/1024).toFixed(2))+" MB)",1)]),t("button",{type:"button",onClick:h=>Z(c),class:"text-red-600 hover:text-red-700"},"Hapus",8,Fe)]))),128))])):d("",!0)]),t("div",null,[e[23]||(e[23]=t("label",{for:"tags",class:"block text-sm font-medium text-gray-700 mb-2"},"Tags",-1)),t("div",De,[t("div",je,[g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>x.value=s),id:"tags",type:"text",class:"w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors hover:border-gray-400",placeholder:"Ketik tag lalu Enter, atau klik saran di bawah",onFocus:G,onInput:q,onKeydown:ae(C(H,["prevent"]),["enter"])},null,40,Se),[[b,x.value]])]),v.value.length>0?(r(),l("div",ze,[(r(!0),l(z,null,A(v.value,s=>(r(),l("button",{key:s.id||s.name,type:"button",class:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:c=>R(s.name)},i(s.name),9,Ae))),128))])):d("",!0),n.value.tags.length>0?(r(),l("div",$e,[(r(!0),l(z,null,A(n.value.tags,(s,c)=>(r(),l("span",{key:c,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-brand-100 text-brand-800"},[f(i(s)+" ",1),t("button",{type:"button",onClick:h=>J(c),class:"ml-2 text-brand-700 hover:text-brand-900"},e[22]||(e[22]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Ee)]))),128))])):d("",!0)]),o.value.tags?(r(),l("div",Le,i(o.value.tags),1)):d("",!0)]),t("div",Pe,[t("div",null,[e[24]||(e[24]=t("label",{for:"effective_date",class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Efektif",-1)),g(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.effective_date=s),id:"effective_date",type:"date",class:p(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",o.value.effective_date?"border-red-500":"border-gray-300 hover:border-gray-400"])},null,2),[[b,n.value.effective_date]]),o.value.effective_date?(r(),l("div",Ue,i(o.value.effective_date),1)):d("",!0)]),t("div",null,[e[25]||(e[25]=t("label",{for:"expiry_date",class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Kadaluarsa",-1)),g(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.expiry_date=s),id:"expiry_date",type:"date",class:p(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",o.value.expiry_date?"border-red-500":"border-gray-300 hover:border-gray-400"])},null,2),[[b,n.value.expiry_date]]),o.value.expiry_date?(r(),l("div",Ie,i(o.value.expiry_date),1)):d("",!0)])]),t("div",null,[e[26]||(e[26]=t("label",{for:"change_notes",class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan Perubahan",-1)),g(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.change_notes=s),id:"change_notes",rows:"3",class:p(["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",o.value.change_notes?"border-red-500":"border-gray-300 hover:border-gray-400"]),placeholder:"Jelaskan perubahan yang dilakukan pada versi ini"},null,2),[[b,n.value.change_notes]]),o.value.change_notes?(r(),l("div",Ke,i(o.value.change_notes),1)):d("",!0)])])])])]),t("div",Ne,[S(M(K),{href:M(B)("admin.knowledge-versions.index"),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500"},{default:j(()=>e[27]||(e[27]=[f(" Batal ",-1)])),_:1,__:[27]},8,["href"]),t("button",{type:"submit",disabled:w.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50"},[w.value?(r(),l("span",Ge)):d("",!0),f(" "+i(w.value?"Menyimpan...":"Simpan Versi"),1)],8,Oe)])],32)])])])]}),_:1},8,["user"]))}};export{We as default};
