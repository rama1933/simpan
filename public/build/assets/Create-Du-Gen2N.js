import{d as pe,r as g,n as ge,p as z,c as fe,o as c,w as f,a as e,b as p,e as V,i as l,t as b,u as d,j as J,k as w,q as E,f as j,s as be,F as G,m as O,g as he,x as ve,v as ye,l as h,h as B,y as xe}from"./app-BMbBdLPb.js";import{_ as ke}from"./AdminLayout-BftLZIss.js";import{u as we,c as _e,a as Ce,b as L,d as q,F as De,e as C,E as D}from"./index.esm-B4u6_Oc9.js";import{_ as I}from"./VueSelect.vue_vue_type_script_setup_true_lang-ClLfV8ht.js";import{r as N}from"./route-BVPoXIPw.js";import"./sidebar.esm-BlsAIMfi.js";const Se={class:"min-h-screen bg-gray-50"},Pe={class:"w-full mx-auto py-6 px-6"},Ve={class:"px-0"},Me={key:0,class:"mb-4"},Fe={class:"rounded-md bg-green-50 p-4 border border-green-200"},Te={class:"text-sm font-medium text-green-800"},je={class:"mb-6 flex items-center justify-between"},Be={class:"grid grid-cols-1 gap-6"},Ke={class:"space-y-6"},$e={class:"bg-white shadow rounded-lg p-6"},Ae={class:"space-y-6"},ze={class:"relative"},Ee=["onClick","disabled"],Ge={key:0,class:"inline-block w-4 h-4 border-2 border-white/70 border-t-transparent rounded-full animate-spin"},Oe={class:"mt-1 text-xs text-gray-400 text-right"},qe={class:"relative"},Ie={class:"mt-1 text-xs text-gray-400 text-right"},Ne={key:0,class:"mt-3 space-y-2"},Ue={class:"truncate"},He={class:"font-medium"},Je={class:"ml-2 text-gray-500"},Le=["onClick"],Re={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Qe={class:"space-y-2"},We={class:"flex gap-2"},Xe=["onKeydown"],Ye={key:0,class:"bg-white border border-gray-200 rounded-md shadow-sm divide-y z-10 max-h-56 overflow-auto"},Ze=["onClick"],et={key:1,class:"flex flex-wrap gap-2"},tt=["onClick"],at={class:"sticky bottom-0 inset-x-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-t border-gray-200 px-6 py-4 flex justify-end gap-3 shadow-lg"},st=["disabled"],nt={key:0},ot={key:1},rt=255,it=500,bt=pe({__name:"Create",props:{categories:{type:Array,default:()=>[]},skpds:{type:Array,default:()=>[]},user:{type:Object,default:null}},setup(U){var H;const K=U,{setFieldValue:lt,values:dt}=we(),S=g(!1),$=g(null),M=g(null),x=g([]),F=g(!1),R=t=>{const a=t.target,o=Array.from(a.files||[]);if(o.length){const r=o.filter(s=>/^(application\/(pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|spreadsheetml\.sheet|presentationml\.presentation)|msword|vnd\.ms-excel|vnd\.ms-powerpoint)|image\/(jpeg|jpg|png))$/.test(s.type));r.length!==o.length&&h.error("Hanya dokumen (PDF/Office) atau gambar (JPG/PNG) yang diizinkan");const u=[...x.value,...r];u.reduce((s,i)=>s+((i==null?void 0:i.size)||0),0)>5*1024*1024?h.error("Total ukuran lampiran maksimal 5MB"):x.value=u}M.value&&(M.value.value="")},Q=()=>{F.value=!0},W=()=>{F.value=!1},X=t=>{var o;F.value=!1;const a=Array.from(((o=t.dataTransfer)==null?void 0:o.files)||[]);if(a.length){const r=a.filter(s=>/^(application\/(pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|spreadsheetml\.sheet|presentationml\.presentation)|msword|vnd\.ms-excel|vnd\.ms-powerpoint)|image\/(jpeg|jpg|png))$/.test(s.type));r.length!==a.length&&h.error("Hanya dokumen (PDF/Office) atau gambar (JPG/PNG) yang diizinkan");const u=[...x.value,...r];u.reduce((s,i)=>s+((i==null?void 0:i.size)||0),0)>5*1024*1024?h.error("Total ukuran lampiran maksimal 5MB"):x.value=u}},Y=t=>{x.value.splice(t,1)};(H=document.querySelector('meta[name="csrf-token"]'))!=null&&H.getAttribute("content");const T=g(!1),v=g(""),m=g([]),k=g([]);let A=null;const Z=async()=>{var t;if(!(v.value.trim().length>0))try{const a=await B.get("/api/knowledge/tags");k.value=((t=a.data)==null?void 0:t.data)||[]}catch{k.value=[]}},ee=()=>{const t=v.value.trim();t&&(t.split(",").map(a=>a.trim()).filter(Boolean).forEach(a=>{m.value.includes(a)||m.value.push(a)}),v.value="")},te=t=>{m.value.splice(t,1)},ae=async()=>{const t=v.value.trim();A&&clearTimeout(A),A=setTimeout(async()=>{var a;if(t.length===0){k.value=[];return}try{const o=await B.get("/api/knowledge/tags",{params:{q:t}});k.value=((a=o.data)==null?void 0:a.data)||[]}catch{k.value=[]}},250)},se=t=>{t&&(m.value.includes(t)||m.value.push(t),v.value="",k.value=[])},ne=async t=>{var o,r,u,n,s;const a=(t||"").trim();if(!(a.length<5))try{S.value=!0;const y=((o=(await B.post("/api/ai/draft-from-title",{title:a})).data)==null?void 0:o.data)||{};if(y.description&&((r=$.value)==null||r.setFieldValue("description",y.description)),y.content&&((u=$.value)==null||u.setFieldValue("content",y.content)),Array.isArray(y.tags))for(const _ of y.tags)_&&!m.value.includes(_)&&m.value.push(String(_));h.success("Draft diisi otomatis oleh AI")}catch(i){h.error(((s=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:s.message)||"Gagal membuat draft dari judul")}finally{S.value=!1}},oe=(t,a)=>{const o=!(t!=null&&t.title)||String(t.title).trim()==="",r=!(t!=null&&t.content)||String(t.content).trim()==="",u=!(t!=null&&t.category_id),n=!(t!=null&&t.skpd_id),s=!(t!=null&&t.status),i=!(t!=null&&t.description)||String(t.description).trim()==="",y=m.value.length===0,_=o&&r&&u&&n&&s&&i&&y;return T.value||!a||_},re=t=>{const a=t==null?void 0:t.target;a&&(a.style.height="auto",a.style.height=a.scrollHeight+"px")},P=g([...K.categories]);ge(()=>K.categories,t=>{P.value=[...t]});const ie=z(()=>P.value.map(t=>({value:t.id,label:t.name}))),le=z(()=>K.skpds.map(t=>({value:t.id,label:t.nama_skpd}))),de=z(()=>[{value:"draft",label:"Draft"},{value:"published",label:"Dipublikasi"},{value:"archived",label:"Diarsipkan"}]),ue=async(t,a)=>{var o,r,u,n;try{const s=await B.post("/api/knowledge/categories/quick-create",{name:t});if((o=s.data)!=null&&o.success&&((r=s.data)!=null&&r.data)){const i=s.data.data;P.value.some(_=>_.id===i.id)||(P.value=[...P.value,i]),a(i.id),h.success("Kategori ditambahkan")}else h.error("Gagal menambah kategori")}catch(s){h.error(((n=(u=s==null?void 0:s.response)==null?void 0:u.data)==null?void 0:n.message)||"Gagal menambah kategori")}},ce=_e({title:q().required("Judul wajib diisi").max(255),description:q().nullable().max(500),content:q().required("Konten wajib diisi").min(10,"Minimal 10 karakter"),category_id:L().typeError("Pilih kategori").required("Kategori wajib diisi"),skpd_id:L().typeError("Pilih SKPD").required("SKPD wajib diisi"),status:Ce().oneOf(["draft","published","archived"]).required("Status wajib diisi")}),me=async t=>{T.value=!0;const a=(v.value||"").trim();a&&(a.split(",").map(r=>r.trim()).filter(Boolean).forEach(r=>{m.value.includes(r)||m.value.push(r)}),v.value="");const o=new FormData;o.append("title",t.title||""),o.append("description",t.description||""),o.append("content",t.content||""),o.append("category_id",String(t.category_id||"")),o.append("skpd_id",String(t.skpd_id||"")),o.append("status",t.status||"draft"),m.value.forEach(r=>o.append("tags[]",r)),x.value.forEach(r=>o.append("attachments[]",r)),xe.post(N("admin.knowledge.store"),o,{forceFormData:!0,onSuccess:()=>{h.success("Pengetahuan berhasil disimpan"),window.scrollTo({top:0,behavior:"auto"})},onFinish:()=>{T.value=!1}})};return(t,a)=>(c(),fe(ke,{"page-title":"Tambah Pengetahuan",user:U.user},{default:f(()=>{var o;return[e("div",Se,[e("div",Pe,[e("div",Ve,[(o=t.$page.props.flash)!=null&&o.success?(c(),p("div",Me,[e("div",Fe,[e("p",Te,b(t.$page.props.flash.success),1)])])):V("",!0),e("div",je,[l(d(J),{href:d(N)("admin.knowledge.index"),class:"text-brand-700 hover:text-brand-800 mr-4"},{default:f(()=>a[2]||(a[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),_:1,__:[2]},8,["href"]),a[3]||(a[3]=e("div",{class:"flex-1"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Tambah Pengetahuan Baru"),e("p",{class:"text-gray-600 mt-2"},"Buat pengetahuan baru untuk sistem manajemen pengetahuan")],-1)),a[4]||(a[4]=e("div",{class:"hidden md:flex items-center gap-3"},[e("span",{class:"inline-flex items-center rounded-full bg-brand-50 px-3 py-1 text-sm font-medium text-brand-700 border border-brand-100"},"Form")],-1))]),l(d(De),{ref_key:"formRef",ref:$,"validation-schema":d(ce),onSubmit:me,class:"space-y-6"},{default:f(({meta:r,values:u})=>[e("div",Be,[e("div",Ke,[e("div",$e,[e("div",Ae,[e("div",null,[a[6]||(a[6]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[w("Judul "),e("span",{class:"text-red-500"},"*")],-1)),l(d(C),{name:"title"},{default:f(({field:n,meta:s})=>[e("div",ze,[a[5]||(a[5]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 012-2h3l2 2h3a2 2 0 012 2v2H4V4zM4 9h12v5a2 2 0 01-2 2H6a2 2 0 01-2-2V9z"})])],-1)),e("input",E(n,{id:"title",type:"text",class:["w-full pl-10 pr-24 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",s.touched&&s.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan judul pengetahuan"}),null,16),e("button",{type:"button",onClick:()=>ne(n.value),disabled:S.value,class:"absolute inset-y-0 right-2 my-1 px-3 inline-flex items-center gap-2 rounded-md text-sm font-medium text-white bg-gradient-to-r from-brand-700 to-brand-500 shadow hover:from-brand-600 hover:to-brand-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50"},[S.value?(c(),p("span",Ge)):V("",!0),e("span",null,b(S.value?"Memprosesâ€¦":"Bantu AI"),1)],8,Ee)]),e("div",Oe,b((n.value||"").length)+"/"+b(rt),1)]),_:2},1024),l(d(D),{name:"title",class:"mt-1 text-sm text-red-600"})]),e("div",null,[a[7]||(a[7]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},"Deskripsi Singkat",-1)),l(d(C),{name:"description"},{default:f(({field:n,meta:s})=>[e("div",qe,[e("textarea",E(n,{id:"description",rows:"3",class:["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",s.touched&&s.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan deskripsi singkat pengetahuan"}),null,16)]),e("div",Ie,b((n.value||"").length)+"/"+b(it),1)]),_:2},1024),l(d(D),{name:"description",class:"mt-1 text-sm text-red-600"})]),e("div",null,[a[8]||(a[8]=e("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-2"},[w("Konten "),e("span",{class:"text-red-500"},"*")],-1)),l(d(C),{name:"content"},{default:f(({field:n,meta:s})=>[e("textarea",E(n,{id:"content",rows:"14",class:["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors resize-none",s.touched&&s.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan konten lengkap pengetahuan",onInput:re}),null,16)]),_:2},1024),l(d(D),{name:"content",class:"mt-1 text-sm text-red-600"})]),e("div",null,[a[10]||(a[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Lampiran",-1)),e("div",{class:be(["border-2 border-dashed rounded-lg p-4 text-center cursor-pointer bg-white hover:bg-gray-50",F.value?"border-brand-400 bg-brand-50/30":"border-gray-300"]),onDragover:j(Q,["prevent"]),onDragleave:j(W,["prevent"]),onDrop:j(X,["prevent"]),onClick:a[0]||(a[0]=()=>{var n;return(n=M.value)==null?void 0:n.click()})},[e("input",{ref_key:"fileInput",ref:M,type:"file",multiple:"",class:"hidden",onChange:R},null,544),a[9]||(a[9]=e("div",{class:"flex flex-col items-center gap-1 text-sm text-gray-600"},[e("svg",{class:"w-8 h-8 text-brand-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12l-2 2m0 0l-2-2m2 2V4"})]),e("span",null,[e("span",{class:"font-medium text-brand-700"},"Klik"),w(" atau seret file ke sini")]),e("span",{class:"text-xs text-gray-400"},"Dokumen (PDF, Office) atau Gambar (JPG/PNG). Total maks 5MB.")],-1))],34),x.value.length?(c(),p("ul",Ne,[(c(!0),p(G,null,O(x.value,(n,s)=>(c(),p("li",{key:s,class:"flex items-center justify-between bg-white border rounded px-3 py-2 text-sm"},[e("div",Ue,[e("span",He,b(n.name),1),e("span",Je,"("+b((n.size/1024/1024).toFixed(2))+" MB)",1)]),e("button",{type:"button",onClick:i=>Y(s),class:"text-red-600 hover:text-red-700"},"Hapus",8,Le)]))),128))])):V("",!0)]),e("div",Re,[e("div",null,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[w("Kategori "),e("span",{class:"text-red-500"},"*")],-1)),l(d(C),{name:"category_id"},{default:f(({field:n})=>[l(I,{modelValue:n.value,"onUpdate:modelValue":s=>n.value=s,options:ie.value,placeholder:"Pilih Kategori atau ketik untuk menambah",onChange:s=>n.onChange(s),onAdd:s=>ue(s,i=>n.onChange(i))},null,8,["modelValue","onUpdate:modelValue","options","onChange","onAdd"])]),_:1}),l(d(D),{name:"category_id",class:"mt-1 text-sm text-red-600"})]),e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[w("SKPD "),e("span",{class:"text-red-500"},"*")],-1)),l(d(C),{name:"skpd_id"},{default:f(({field:n})=>[l(I,{modelValue:n.value,"onUpdate:modelValue":s=>n.value=s,options:le.value,placeholder:"Pilih SKPD",onChange:s=>n.onChange(s)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),l(d(D),{name:"skpd_id",class:"mt-1 text-sm text-red-600"})]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[w("Status "),e("span",{class:"text-red-500"},"*")],-1)),l(d(C),{name:"status"},{default:f(({field:n})=>[l(I,{modelValue:n.value,"onUpdate:modelValue":s=>n.value=s,options:de.value,placeholder:"Pilih Status",onChange:s=>n.onChange(s)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),l(d(D),{name:"status",class:"mt-1 text-sm text-red-600"})])]),e("div",null,[a[15]||(a[15]=e("label",{for:"tags",class:"block text-sm font-medium text-gray-700 mb-2"},"Tags",-1)),e("div",Qe,[e("div",We,[he(e("input",{"onUpdate:modelValue":a[1]||(a[1]=n=>v.value=n),id:"tags",type:"text",class:"w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors hover:border-gray-400",placeholder:"Ketik tag lalu Enter, atau klik saran di bawah",onFocus:Z,onInput:ae,onKeydown:ve(j(ee,["prevent"]),["enter"])},null,40,Xe),[[ye,v.value]])]),k.value.length>0?(c(),p("div",Ye,[(c(!0),p(G,null,O(k.value,n=>(c(),p("button",{key:n.id||n.name,type:"button",class:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:s=>se(n.name)},b(n.name),9,Ze))),128))])):V("",!0),m.value.length>0?(c(),p("div",et,[(c(!0),p(G,null,O(m.value,(n,s)=>(c(),p("span",{key:s,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-brand-100 text-brand-800"},[w(b(n)+" ",1),e("button",{type:"button",onClick:i=>te(s),class:"ml-2 text-brand-700 hover:text-brand-900"},a[14]||(a[14]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,tt)]))),128))])):V("",!0)])])])])])]),e("div",at,[l(d(J),{href:d(N)("admin.knowledge.index"),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500"},{default:f(()=>a[16]||(a[16]=[w("Batal",-1)])),_:1,__:[16]},8,["href"]),e("button",{type:"submit",disabled:oe(u,r.valid),class:"px-5 py-2.5 border border-transparent rounded-md shadow-sm text-sm font-semibold text-white bg-brand-700 hover:bg-brand-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed"},[T.value?(c(),p("span",nt,"Menyimpan...")):(c(),p("span",ot,"Simpan Pengetahuan"))],8,st)])]),_:1},8,["validation-schema"])])])])]}),_:1},8,["user"]))}});export{bt as default};
