import{d as _e,r as f,n as G,c as Ce,o as u,w as v,a as e,i as r,u as i,l as Z,j as x,p as O,b as c,e as P,F,k as B,t as C,g as ee,z as Se,f as z,q as De,s as Pe,v as Ve,x as w,h as U,y as Me}from"./app-DeiHe0Bs.js";import{_ as Te}from"./AdminLayout-zf6dvYO0.js";import{_ as q}from"./VueSelect.vue_vue_type_script_setup_true_lang-CbjF3wzP.js";import{u as je,c as Fe,a as Be,b as te,d as A,F as ze,e as S,E as D}from"./index.esm-DnXXkWSj.js";import{r as H}from"./route-BVPoXIPw.js";import"./sidebar.esm-B5SVcvLi.js";const Ee={class:"min-h-screen bg-gray-50"},Ke={class:"w-full mx-auto py-6 px-6"},$e={class:"px-0"},Ge={class:"mb-6 flex items-center justify-between"},Oe={class:"grid grid-cols-1 gap-6"},Ue={class:"space-y-6 bg-white shadow rounded-lg p-6"},qe={class:"relative"},Ae={class:"relative"},He={key:0,class:"mb-3 space-y-2"},Ie={class:"space-y-2"},Ne={class:"truncate flex items-center gap-2"},Je=["title"],Le={class:"text-gray-500"},Re={class:"inline-flex items-center gap-2 text-red-600 cursor-pointer"},Qe=["value"],We={key:1,class:"mt-3 space-y-2"},Xe={class:"truncate"},Ye={class:"font-medium"},Ze={class:"ml-2 text-gray-500"},et=["onClick"],tt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},at={class:"space-y-2"},ot={class:"flex gap-2"},nt=["onKeydown"],st={key:0,class:"bg-white border border-gray-200 rounded-md shadow-sm divide-y z-10 max-h-56 overflow-auto"},lt=["onClick"],rt={key:1,class:"flex flex-wrap gap-2"},it=["onClick"],dt={class:"sticky bottom-0 inset-x-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-t border-gray-200 px-6 py-4 flex justify-end gap-3 shadow-lg"},ut=["disabled"],ct={key:0},pt={key:1},yt=_e({__name:"Edit",props:{knowledge:{},categories:{},skpds:{},user:{}},setup(ae){var N,J,L,R,Q,W,X,Y;const m=ae,_={title:((N=m.knowledge)==null?void 0:N.title)||"",description:((J=m.knowledge)==null?void 0:J.description)||"",content:((L=m.knowledge)==null?void 0:L.content)||"",category_id:((R=m.knowledge)==null?void 0:R.category_id)||"",skpd_id:((Q=m.knowledge)==null?void 0:Q.skpd_id)||"",status:((W=m.knowledge)==null?void 0:W.status)||"draft"},oe=f(null),{setFieldValue:mt}=je(),V=f(null),y=f([]),I=f(((X=m.knowledge)==null?void 0:X.attachments)||[]),E=f([]),M=f(!1),ne=a=>{const t=a.target,s=Array.from(t.files||[]);if(s.length){const l=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","image/jpeg","image/jpg","image/png"],o=s.filter(p=>l.includes(p.type));o.length!==s.length&&w.error("Hanya dokumen (PDF/Office) atau gambar (JPG/PNG) yang diizinkan");const n=[...y.value,...o];n.reduce((p,b)=>p+((b==null?void 0:b.size)||0),0)>5*1024*1024?w.error("Total ukuran lampiran maksimal 5MB"):y.value=n}V.value&&(V.value.value="")},se=()=>{M.value=!0},le=()=>{M.value=!1},re=a=>{var d;M.value=!1;const t=Array.from(((d=a.dataTransfer)==null?void 0:d.files)||[]);if(!t.length)return;const s=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","image/jpeg","image/jpg","image/png"],l=t.filter(p=>s.includes(p.type));l.length!==t.length&&w.error("Hanya dokumen (PDF/Office) atau gambar (JPG/PNG) yang diizinkan");const o=[...y.value,...l];o.reduce((p,b)=>p+((b==null?void 0:b.size)||0),0)>5*1024*1024?w.error("Total ukuran lampiran maksimal 5MB"):y.value=o},ie=a=>{y.value.splice(a,1)},de=a=>!a||a<=0?"0 B":`${(a/1024/1024).toFixed(2)} MB`,h=f(""),g=f(Array.isArray((Y=m.knowledge)==null?void 0:Y.tags)?m.knowledge.tags:[]),k=f([]);let K=null;const ue=async()=>{var a;if(!(h.value.trim().length>0))try{const t=await U.get("/api/knowledge/tags");k.value=((a=t.data)==null?void 0:a.data)||[]}catch{k.value=[]}},ce=()=>{const a=h.value.trim();K&&clearTimeout(K),K=setTimeout(async()=>{var t;if(a.length===0){k.value=[];return}try{const s=await U.get("/api/knowledge/tags",{params:{q:a}});k.value=((t=s.data)==null?void 0:t.data)||[]}catch{k.value=[]}},250)},pe=()=>{const a=h.value.trim();a&&(a.split(",").map(t=>t.trim()).filter(Boolean).forEach(t=>{g.value.includes(t)||g.value.push(t)}),h.value="")},me=a=>g.value.splice(a,1),ge=a=>{a&&(g.value.includes(a)||g.value.push(a),h.value="",k.value=[])},T=f([...m.categories]),fe=G(()=>T.value.map(a=>({value:a.id,label:a.name}))),be=G(()=>m.skpds.map(a=>({value:a.id,label:a.nama_skpd}))),ve=G(()=>[{value:"draft",label:"Draft"},{value:"published",label:"Dipublikasi"},{value:"archived",label:"Diarsipkan"}]),he=async(a,t)=>{var s,l,o,n;try{const d=await U.post("/api/knowledge/categories/quick-create",{name:a});if((s=d.data)!=null&&s.success&&((l=d.data)!=null&&l.data)){const p=d.data.data;T.value.some($=>$.id===p.id)||(T.value=[...T.value,p]),t(p.id),w.success("Kategori ditambahkan")}else w.error("Gagal menambah kategori")}catch(d){w.error(((n=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:n.message)||"Gagal menambah kategori")}},xe=Fe({title:A().required("Judul wajib diisi").max(255),description:A().nullable().max(500),content:A().required("Konten wajib diisi").min(10,"Minimal 10 karakter"),category_id:te().typeError("Pilih kategori").required("Kategori wajib diisi"),skpd_id:te().typeError("Pilih SKPD").required("SKPD wajib diisi"),status:Be().oneOf(["draft","published","archived"]).required("Status wajib diisi")}),j=f(!1),ye=(a,t)=>{const s=!(a!=null&&a.title)||String(a.title).trim()==="",l=!(a!=null&&a.content)||String(a.content).trim()==="",o=!(a!=null&&a.category_id),n=!(a!=null&&a.skpd_id),d=!(a!=null&&a.status),p=!(a!=null&&a.description)||String(a.description).trim()==="",b=g.value.length===0,$=s&&l&&o&&n&&d&&p&&b;return j.value||!t||$},ke=a=>{const t=a==null?void 0:a.target;t&&(t.style.height="auto",t.style.height=t.scrollHeight+"px")},we=async a=>{j.value=!0;const t=(h.value||"").trim();t&&(t.split(",").map(l=>l.trim()).filter(Boolean).forEach(l=>{g.value.includes(l)||g.value.push(l)}),h.value="");const s=new FormData;s.append("title",a.title||""),s.append("description",a.description||""),s.append("content",a.content||""),s.append("category_id",String(a.category_id||"")),s.append("skpd_id",String(a.skpd_id||"")),s.append("status",a.status||"draft"),g.value.forEach(l=>s.append("tags[]",l)),y.value.forEach(l=>s.append("attachments[]",l)),E.value.forEach(l=>s.append("remove_attachment_ids[]",String(l))),s.append("_method","PUT"),Me.post(H("admin.knowledge.update",m.knowledge.id),s,{forceFormData:!0,onSuccess:()=>{w.success("Berhasil mengubah pengetahuan"),window.scrollTo({top:0,behavior:"auto"})},onFinish:()=>{j.value=!1}})};return(a,t)=>(u(),Ce(Te,{"page-title":"Edit Pengetahuan",user:a.user},{default:v(()=>[e("div",Ee,[e("div",Ke,[e("div",$e,[e("div",Ge,[r(i(Z),{href:i(H)("admin.knowledge.show",a.knowledge.id),class:"text-brand-700 hover:text-brand-800 mr-4"},{default:v(()=>t[3]||(t[3]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),_:1,__:[3]},8,["href"]),t[4]||(t[4]=e("div",{class:"flex-1"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Edit Pengetahuan"),e("p",{class:"text-gray-600 mt-2"},"Perbarui data pengetahuan")],-1)),t[5]||(t[5]=e("div",{class:"hidden md:flex items-center gap-3"},[e("span",{class:"inline-flex items-center rounded-full bg-brand-50 px-3 py-1 text-sm font-medium text-brand-700 border border-brand-100"},"Form")],-1))]),r(i(ze),{ref_key:"formRef",ref:oe,"validation-schema":i(xe),onSubmit:we,class:"space-y-6"},{default:v(({meta:s,values:l})=>[e("div",Oe,[e("div",Ue,[e("div",null,[t[7]||(t[7]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[x("Judul "),e("span",{class:"text-red-500"},"*")],-1)),r(i(S),{name:"title","model-value":_.title},{default:v(({field:o,meta:n})=>[e("div",qe,[t[6]||(t[6]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 012-2h3l2 2h3a2 2 0 012 2v2H4V4zM4 9h12v5a2 2 0 01-2 2H6a2 2 0 01-2-2V9z"})])],-1)),e("input",O(o,{id:"title",type:"text",class:["w-full pl-10 pr-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.touched&&n.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan judul pengetahuan"}),null,16)])]),_:2},1032,["model-value"]),r(i(D),{name:"title",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[8]||(t[8]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"},"Deskripsi Singkat",-1)),r(i(S),{name:"description","model-value":_.description},{default:v(({field:o,meta:n})=>[e("div",Ae,[e("textarea",O(o,{id:"description",rows:"3",class:["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors",n.touched&&n.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan deskripsi singkat pengetahuan"}),null,16)])]),_:2},1032,["model-value"]),r(i(D),{name:"description",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[9]||(t[9]=e("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-2"},[x("Konten "),e("span",{class:"text-red-500"},"*")],-1)),r(i(S),{name:"content","model-value":_.content},{default:v(({field:o,meta:n})=>[e("textarea",O(o,{id:"content",rows:"14",class:["w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors resize-none",n.touched&&n.invalid?"border-red-500":"border-gray-300 hover:border-gray-400"],placeholder:"Masukkan konten lengkap pengetahuan",onInput:ke}),null,16)]),_:2},1032,["model-value"]),r(i(D),{name:"content",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Lampiran",-1)),I.value.length?(u(),c("div",He,[t[12]||(t[12]=e("div",{class:"text-xs text-gray-500"},"Lampiran saat ini:",-1)),e("ul",Ie,[(u(!0),c(F,null,B(I.value,o=>(u(),c("li",{key:o.id,class:"flex items-center justify-between bg-gray-50 border rounded px-3 py-2 text-sm"},[e("div",Ne,[t[10]||(t[10]=e("svg",{class:"w-4 h-4 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"})],-1)),e("span",{class:"font-medium truncate max-w-[320px]",title:o.original_name},C(o.original_name),9,Je),e("span",Le,"("+C(de(o.size_bytes))+")",1)]),e("label",Re,[ee(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=n=>E.value=n),value:o.id,class:"rounded border-gray-300 text-red-600 focus:ring-red-500"},null,8,Qe),[[Se,E.value]]),t[11]||(t[11]=x(" Hapus ",-1))])]))),128))])])):P("",!0),e("div",{class:De(["border-2 border-dashed rounded-lg p-4 text-center cursor-pointer bg-white hover:bg-gray-50",M.value?"border-brand-400 bg-brand-50/30":"border-gray-300"]),onDragover:z(se,["prevent"]),onDragleave:z(le,["prevent"]),onDrop:z(re,["prevent"]),onClick:t[1]||(t[1]=()=>{var o;return(o=V.value)==null?void 0:o.click()})},[e("input",{ref_key:"fileInput",ref:V,type:"file",multiple:"",class:"hidden",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png",onChange:ne},null,544),t[13]||(t[13]=e("div",{class:"flex flex-col items-center gap-1 text-sm text-gray-600"},[e("svg",{class:"w-8 h-8 text-brand-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12l-2 2m0 0l-2-2m2 2V4"})]),e("span",null,[e("span",{class:"font-medium text-brand-700"},"Klik"),x(" atau seret file ke sini")]),e("span",{class:"text-xs text-gray-400"},"Dokumen (PDF, Office) atau Gambar (JPG/PNG). Total maks 5MB.")],-1))],34),y.value.length?(u(),c("ul",We,[(u(!0),c(F,null,B(y.value,(o,n)=>(u(),c("li",{key:n,class:"flex items-center justify-between bg-white border rounded px-3 py-2 text-sm"},[e("div",Xe,[e("span",Ye,C(o.name),1),e("span",Ze,"("+C((o.size/1024/1024).toFixed(2))+" MB)",1)]),e("button",{type:"button",onClick:d=>ie(n),class:"text-red-600 hover:text-red-700"},"Hapus",8,et)]))),128))])):P("",!0)]),e("div",tt,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[x("Kategori "),e("span",{class:"text-red-500"},"*")],-1)),r(i(S),{name:"category_id","model-value":_.category_id},{default:v(({field:o})=>[r(q,{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,options:fe.value,placeholder:"Pilih Kategori atau ketik untuk menambah",onChange:n=>o.onChange(n),onAdd:n=>he(n,d=>o.onChange(d))},null,8,["modelValue","onUpdate:modelValue","options","onChange","onAdd"])]),_:1},8,["model-value"]),r(i(D),{name:"category_id",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[x("SKPD "),e("span",{class:"text-red-500"},"*")],-1)),r(i(S),{name:"skpd_id","model-value":_.skpd_id},{default:v(({field:o})=>[r(q,{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,options:be.value,placeholder:"Pilih SKPD",onChange:n=>o.onChange(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["model-value"]),r(i(D),{name:"skpd_id",class:"mt-1 text-sm text-red-600"})]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[x("Status "),e("span",{class:"text-red-500"},"*")],-1)),r(i(S),{name:"status","model-value":_.status},{default:v(({field:o})=>[r(q,{modelValue:o.value,"onUpdate:modelValue":n=>o.value=n,options:ve.value,placeholder:"Pilih Status",onChange:n=>o.onChange(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["model-value"]),r(i(D),{name:"status",class:"mt-1 text-sm text-red-600"})])]),e("div",null,[t[19]||(t[19]=e("label",{for:"tags",class:"block text-sm font-medium text-gray-700 mb-2"},"Tags",-1)),e("div",at,[e("div",ot,[ee(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>h.value=o),id:"tags",type:"text",class:"w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 border transition-colors hover:border-gray-400",placeholder:"Ketik tag lalu Enter, atau klik saran di bawah",onFocus:ue,onInput:ce,onKeydown:Pe(z(pe,["prevent"]),["enter"])},null,40,nt),[[Ve,h.value]])]),k.value.length>0?(u(),c("div",st,[(u(!0),c(F,null,B(k.value,o=>(u(),c("button",{key:o.id||o.name,type:"button",class:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50",onClick:n=>ge(o.name)},C(o.name),9,lt))),128))])):P("",!0),g.value.length>0?(u(),c("div",rt,[g.value.length>0?(u(!0),c(F,{key:0},B(g.value,(o,n)=>(u(),c("span",{key:n,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-brand-100 text-brand-800"},[x(C(o)+" ",1),e("button",{type:"button",onClick:d=>me(n),class:"ml-2 text-brand-700 hover:text-brand-900"},t[18]||(t[18]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,it)]))),128)):P("",!0)])):P("",!0)])])])]),e("div",dt,[r(i(Z),{href:i(H)("admin.knowledge.show",a.knowledge.id),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500"},{default:v(()=>t[20]||(t[20]=[x("Batal",-1)])),_:1,__:[20]},8,["href"]),e("button",{type:"submit",disabled:ye(l,s.valid),class:"px-5 py-2.5 border border-transparent rounded-md shadow-sm text-sm font-semibold text-white bg-brand-700 hover:bg-brand-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed"},[j.value?(u(),c("span",ct,"Menyimpan...")):(u(),c("span",pt,"Simpan Perubahan"))],8,ut)])]),_:1},8,["validation-schema"])])])])]),_:1},8,["user"]))}});export{yt as default};
